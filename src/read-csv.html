<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        
    </head>

    <body>
        <div>
            <h1>Select Watches File</h1>
            <input id="watch_sel" type="file"></input>
            <textarea id="watch_show" cols="90" rows="20"></textarea>
            <br>
            <h1>Select Devices/Components File</h1>
            <input id="device_sel" type="file"></input>
            <textarea id="device_show" cols="90" rows="20"></textarea>
        </div>
        <script>
            let input_w = document.querySelector('#watch_sel')
            let textarea_w = document.querySelector('#watch_show')
            let input_d = document.querySelector('#device_sel')
            let textarea_d = document.querySelector('#device_show')
            
            const watch = {
                idWatch: "0",
                urlWatch: "000"
            };
            const device = {
                idDevice: "0",
                urlDevice: "000",
                idParentWatch: "0"
            };

            const watches = [];
            const devices = [];

            input_w.addEventListener('change', ()=> {

                let files = input_w.files;

                if(files.length == 0) return;

                const file = files[0];
                let reader = new FileReader();

                reader.onload = (e) => {
                    const file = e.target.result;
                    const lines = file.split(/\r\n|\n/);
                    for (i=0; i<lines.length-1;i++) {
                        let infos = lines[i].split(",");
                        let tmp_watch = {idWatch:infos[0], urlWatch:infos[1]}
                        watches.push(tmp_watch)
                    }
                    for(w in watches) {
                    textarea_w.value += watches[w].idWatch;
                    textarea_w.value += '\t';
                    textarea_w.value += watches[w].urlWatch;
                    textarea_w.value += '\n';
                }
                };

                reader.onerror = (e) => alert(e.target.error.name);
                reader.readAsText(file)
            });

            input_d.addEventListener('change', ()=> {

                let files = input_d.files;

                if(files.length == 0) return;

                const file = files[0];
                let reader = new FileReader();

                reader.onload = (e) => {
                    const file = e.target.result;
                    const lines = file.split(/\r\n|\n/);
                    for (i=0; i<lines.length-1; i++) {
                        let infos = lines[i].split(",");
                        let tmp_device = {idDevice:infos[0], urlDevice:infos[1], idParentWatch:infos[2]}
                        devices.push(tmp_device)
                    }
                    for(d in devices) {
                        textarea_d.value += devices[d].idDevice;
                        textarea_d.value += '\t';
                        textarea_d.value += devices[d].urlDevice;
                        textarea_d.value += '\t';
                        textarea_d.value += devices[d].idParentWatch;
                        textarea_d.value += '\n';
                    }
                };

                reader.onerror = (e) => alert(e.target.error.name);
                reader.readAsText(file)

            });
    

        </script>
    </body>
</html>